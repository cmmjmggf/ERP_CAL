<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="prenomfisbanamex" language="groovy" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="82c06bc2-fd12-4810-b55f-bf6126804875">
	<property name="ireport.zoom" value="3.138428376721007"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="empresa" class="java.lang.String"/>
	<parameter name="logo" class="java.lang.String"/>
	<parameter name="SEMANA" class="java.lang.Integer"/>
	<parameter name="FECHAINI" class="java.lang.String"/>
	<parameter name="FECHAFIN" class="java.lang.String"/>
	<parameter name="ANIO" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT
IFNULL(D.Clave,999) AS CLAVE, IFNULL(D.Descripcion,"NO EXISTE DEPTO") AS DEPARTAMENTO,
E.Numero AS CLAVE_EMPLEADO,
CONCAT(E.PrimerNombre,' ', E.SegundoNombre,' ',E.Paterno,' ', E.Materno) AS NOMBRE_EMPLEADO, (CASE WHEN E.TBanamex = 0 THEN "" ELSE E.TBanamex END) AS CUENTA,
(PNL.salario+PNL.salariod+PNL.horext+PNL.otrper+PNL.otrper1 - PNL.infon - PNL.imss - PNL.impu - PNL.precaha - PNL.cajhao - PNL.vtazap -
PNL.zapper - PNL.fune - PNL.cargo - PNL.fonac - PNL.otrde - PNL.otrde1) AS SUELDO_NETO, E.SueldoFijo AS SUELDO_FIS,
(CASE
WHEN E.SueldoFijo > (PNL.salario+PNL.salariod+PNL.horext+PNL.otrper+PNL.otrper1 - PNL.infon - PNL.imss - PNL.impu - PNL.precaha - PNL.cajhao - PNL.vtazap -
PNL.zapper - PNL.fune - PNL.cargo - PNL.fonac - PNL.otrde - PNL.otrde1)  THEN 0 ELSE E.SueldoFijo END) AS ABONO_FIS,
(CASE
WHEN (PNL.salario+PNL.salariod+PNL.horext+PNL.otrper+PNL.otrper1 - PNL.infon - PNL.imss - PNL.impu - PNL.precaha - PNL.cajhao - PNL.vtazap -
PNL.zapper - PNL.fune - PNL.cargo - PNL.fonac - PNL.otrde - PNL.otrde1) > E.SueldoFijo THEN
((PNL.salario+PNL.salariod+PNL.horext+PNL.otrper+PNL.otrper1 - PNL.infon - PNL.imss - PNL.impu - PNL.precaha - PNL.cajhao - PNL.vtazap - PNL.zapper - PNL.fune - PNL.cargo - PNL.fonac - PNL.otrde - PNL.otrde1) - E.SueldoFijo)
ELSE
(PNL.salario+PNL.salariod+PNL.horext+PNL.otrper+PNL.otrper1 - PNL.infon - PNL.imss - PNL.impu - PNL.precaha - PNL.cajhao - PNL.vtazap - PNL.zapper - PNL.fune - PNL.cargo - PNL.fonac - PNL.otrde - PNL.otrde1)
END) AS ABONO_NOMINA

FROM empleados AS E LEFT JOIN departamentos AS D ON E.DepartamentoFisico = D.Clave INNER JOIN prenominal AS PNL
ON E.Numero = PNL.numemp
WHERE PNL.numsem = $P{SEMANA} AND PNL.aÃ±o = $P{ANIO} AND E.Tarjeta = 1 ORDER BY ABS(CLAVE) ASC]]>
	</queryString>
	<field name="CLAVE" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="DEPARTAMENTO" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="CLAVE_EMPLEADO" class="java.lang.Integer"/>
	<field name="NOMBRE_EMPLEADO" class="java.lang.String"/>
	<field name="CUENTA" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="SUELDO_NETO" class="java.lang.Double"/>
	<field name="SUELDO_FIS" class="java.lang.Float"/>
	<field name="ABONO_FIS" class="java.lang.Double"/>
	<field name="ABONO_NOMINA" class="java.lang.Double"/>
	<variable name="SUELDO_NETO_1" class="java.lang.Double" resetType="Group" resetGroup="DEPARTAMENTO" calculation="Sum">
		<variableExpression><![CDATA[$F{SUELDO_NETO}]]></variableExpression>
	</variable>
	<variable name="SUELDO_FIS_1" class="java.lang.Float" resetType="Group" resetGroup="DEPARTAMENTO" calculation="Sum">
		<variableExpression><![CDATA[$F{SUELDO_FIS}]]></variableExpression>
	</variable>
	<variable name="ABONO_FIS_1" class="java.lang.Double" resetType="Group" resetGroup="DEPARTAMENTO" calculation="Sum">
		<variableExpression><![CDATA[$F{ABONO_FIS}]]></variableExpression>
	</variable>
	<variable name="ABONO_NOMINA_1" class="java.lang.Double" resetType="Group" resetGroup="DEPARTAMENTO" calculation="Sum">
		<variableExpression><![CDATA[$F{ABONO_NOMINA}]]></variableExpression>
	</variable>
	<variable name="SUELDO_NETO_2" class="java.lang.Double" calculation="Sum">
		<variableExpression><![CDATA[$F{SUELDO_NETO}]]></variableExpression>
	</variable>
	<variable name="SUELDO_FIS_2" class="java.lang.Float" calculation="Sum">
		<variableExpression><![CDATA[$F{SUELDO_FIS}]]></variableExpression>
	</variable>
	<variable name="ABONO_FIS_2" class="java.lang.Double" calculation="Sum">
		<variableExpression><![CDATA[$F{ABONO_FIS}]]></variableExpression>
	</variable>
	<variable name="ABONO_NOMINA_2" class="java.lang.Double" calculation="Sum">
		<variableExpression><![CDATA[$F{ABONO_NOMINA}]]></variableExpression>
	</variable>
	<group name="DEPARTAMENTO">
		<groupExpression><![CDATA[$F{DEPARTAMENTO}]]></groupExpression>
		<groupHeader>
			<band height="10">
				<textField>
					<reportElement x="0" y="0" width="30" height="10" uuid="41d17729-446c-4ebd-852d-8b3a3bc8d06c"/>
					<box>
						<topPen lineWidth="2.0"/>
						<bottomPen lineWidth="2.0"/>
					</box>
					<textElement>
						<font size="6" isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{CLAVE}]]></textFieldExpression>
				</textField>
				<textField>
					<reportElement x="30" y="0" width="117" height="10" uuid="3f4bd097-e982-4370-a64e-6db3051a7680"/>
					<box>
						<topPen lineWidth="2.0"/>
						<bottomPen lineWidth="2.0"/>
					</box>
					<textElement>
						<font size="6" isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{DEPARTAMENTO}]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
	</group>
	<background>
		<band splitType="Stretch"/>
	</background>
	<columnHeader>
		<band height="69">
			<staticText>
				<reportElement isPrintRepeatedValues="false" x="72" y="16" width="145" height="14" isPrintInFirstWholeBand="true" uuid="660afdd6-47c1-40fe-aa49-8f0f7ee738f2"/>
				<textElement verticalAlignment="Middle">
					<font size="9" isBold="true"/>
				</textElement>
				<text><![CDATA[Reporte de nomina de la semana]]></text>
			</staticText>
			<textField>
				<reportElement isPrintRepeatedValues="false" x="72" y="0" width="246" height="16" isPrintInFirstWholeBand="true" uuid="acf1674d-8383-4182-83a8-ad3cf9bb07b9"/>
				<textElement>
					<font size="11" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{empresa}]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report">
				<reportElement isPrintRepeatedValues="false" x="541" y="0" width="15" height="12" isPrintInFirstWholeBand="true" uuid="9564d570-f4af-4b3a-bc73-1a39ce64dd69"/>
				<textElement textAlignment="Left">
					<font fontName="SansSerif" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
			<textField pattern="EEE, d MMM yyyy HH:mm:ss">
				<reportElement isPrintRepeatedValues="false" x="417" y="11" width="139" height="12" isPrintInFirstWholeBand="true" uuid="f87076c2-ccc5-4d14-ab98-47d775e84bfb"/>
				<textElement textAlignment="Right">
					<font fontName="SansSerif" size="9" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement isPrintRepeatedValues="false" x="460" y="0" width="80" height="12" isPrintInFirstWholeBand="true" uuid="e79e7db9-b308-43e2-bbe6-2c01c9007f6e"/>
				<textElement textAlignment="Right">
					<font fontName="SansSerif" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA["Pag. "+$V{PAGE_NUMBER}+" de"]]></textFieldExpression>
			</textField>
			<image>
				<reportElement isPrintRepeatedValues="false" x="0" y="0" width="72" height="42" isPrintInFirstWholeBand="true" uuid="081844f8-8ac6-4d18-88e3-8e7eec18f17c"/>
				<imageExpression><![CDATA[$P{logo}]]></imageExpression>
			</image>
			<textField>
				<reportElement x="217" y="16" width="30" height="14" uuid="f75fcca0-2d3b-4675-bf94-ca341021bf29"/>
				<textElement textAlignment="Center">
					<font size="9"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{SEMANA}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement isPrintRepeatedValues="false" x="73" y="30" width="22" height="14" isPrintInFirstWholeBand="true" uuid="a4633bcd-e475-4946-b246-89361862844e"/>
				<textElement textAlignment="Center">
					<font size="9" isBold="true"/>
				</textElement>
				<text><![CDATA[Del]]></text>
			</staticText>
			<textField>
				<reportElement x="95" y="30" width="64" height="14" uuid="e76f8ee1-d119-4142-bb30-60b2ab3d7c5a"/>
				<textElement>
					<font size="9"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{FECHAINI}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement isPrintRepeatedValues="false" x="160" y="30" width="22" height="14" isPrintInFirstWholeBand="true" uuid="0520504e-6198-4666-82ce-344fd1e1b07e"/>
				<textElement textAlignment="Center">
					<font size="9" isBold="true"/>
				</textElement>
				<text><![CDATA[Al]]></text>
			</staticText>
			<textField pattern="" isBlankWhenNull="false">
				<reportElement mode="Transparent" x="184" y="30" width="75" height="14" forecolor="#000000" backcolor="#FFFFFF" uuid="b8d1dfd7-acae-4163-8aea-58b873cdcde9"/>
				<textElement textAlignment="Left" verticalAlignment="Top" rotation="None" markup="none">
					<font fontName="SansSerif" size="9" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{FECHAFIN}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement isPrintRepeatedValues="false" x="259" y="20" width="158" height="18" isPrintInFirstWholeBand="true" uuid="7469c58d-1cca-4ebf-a422-1da63a7f605e"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center">
					<font size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[Banamex]]></text>
			</staticText>
			<staticText>
				<reportElement isPrintRepeatedValues="false" x="0" y="58" width="317" height="10" isPrintInFirstWholeBand="true" uuid="63be3c30-5071-4ebe-bb11-1e6e1ace8626"/>
				<textElement>
					<font size="7" isBold="true"/>
				</textElement>
				<text><![CDATA[Departamento]]></text>
			</staticText>
			<staticText>
				<reportElement isPrintRepeatedValues="false" x="317" y="58" width="73" height="10" isPrintInFirstWholeBand="true" uuid="c31786c5-705a-4842-a581-047887ae065f"/>
				<textElement textAlignment="Center">
					<font size="7" isBold="true"/>
				</textElement>
				<text><![CDATA[No. de cuenta]]></text>
			</staticText>
			<line>
				<reportElement x="0" y="68" width="555" height="1" uuid="140d3a99-b24d-4380-90ac-bc639631871f"/>
			</line>
			<staticText>
				<reportElement isPrintRepeatedValues="false" x="389" y="58" width="109" height="10" isPrintInFirstWholeBand="true" uuid="133742f3-91c9-40fd-8078-dfad33f11c5c"/>
				<textElement textAlignment="Center">
					<font size="7" isBold="true"/>
				</textElement>
				<text><![CDATA[Abono Neto]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="11" splitType="Stretch">
			<textField pattern="" isBlankWhenNull="false">
				<reportElement mode="Transparent" x="117" y="0" width="30" height="10" forecolor="#000000" backcolor="#FFFFFF" uuid="e56e84c3-380c-4f14-81ee-f21c56608dbb"/>
				<textElement textAlignment="Left" verticalAlignment="Top" rotation="None" markup="none">
					<font fontName="SansSerif" size="6" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{CLAVE_EMPLEADO}]]></textFieldExpression>
			</textField>
			<textField pattern="" isBlankWhenNull="false">
				<reportElement mode="Transparent" x="147" y="0" width="170" height="10" forecolor="#000000" backcolor="#FFFFFF" uuid="1c700aa4-e5f2-4de0-9171-45ad484bb817"/>
				<textElement textAlignment="Left" verticalAlignment="Top" rotation="None" markup="none">
					<font fontName="SansSerif" size="6" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{NOMBRE_EMPLEADO}]]></textFieldExpression>
			</textField>
			<textField pattern="" isBlankWhenNull="false">
				<reportElement mode="Transparent" x="318" y="0" width="71" height="10" forecolor="#000000" backcolor="#FFFFFF" uuid="90a0db45-e6d1-4d44-a285-9628dc331d83"/>
				<textElement textAlignment="Center" verticalAlignment="Top" rotation="None" markup="none">
					<font fontName="SansSerif" size="6" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{CUENTA}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00" isBlankWhenNull="false">
				<reportElement mode="Transparent" x="390" y="0" width="108" height="10" forecolor="#000000" backcolor="#FFFFFF" uuid="8a53cd18-88da-4af5-882b-7ed0ebfcc990"/>
				<textElement textAlignment="Right" verticalAlignment="Top" rotation="None" markup="none">
					<font fontName="SansSerif" size="6" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{ABONO_NOMINA}]]></textFieldExpression>
			</textField>
			<line>
				<reportElement x="117" y="10" width="438" height="1" uuid="cf56394f-cf2c-499f-aae8-df7689ab0516"/>
			</line>
		</band>
	</detail>
	<summary>
		<band height="11" splitType="Stretch">
			<staticText>
				<reportElement isPrintRepeatedValues="false" x="217" y="0" width="111" height="11" isPrintInFirstWholeBand="true" uuid="4d416caf-f767-417f-95fb-d0aab9423727"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Total general de nomina]]></text>
			</staticText>
			<textField pattern="#,##0.00" isBlankWhenNull="false">
				<reportElement mode="Transparent" x="390" y="0" width="108" height="11" forecolor="#000000" backcolor="#FFFFFF" uuid="8adcf2c6-dae9-40be-b7fe-c5320ea7e237"/>
				<textElement textAlignment="Right" verticalAlignment="Top" rotation="None" markup="none">
					<font fontName="SansSerif" size="7" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{ABONO_NOMINA_2}]]></textFieldExpression>
			</textField>
		</band>
	</summary>
</jasperReport>
